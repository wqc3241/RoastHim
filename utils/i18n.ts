type Locale = 'zh' | 'en';

const detectLocale = (): Locale => {
  if (typeof navigator === 'undefined') return 'en';
  const langs = navigator.languages?.length ? navigator.languages : [navigator.language];
  return langs.some((lang) => lang.toLowerCase().startsWith('zh')) ? 'zh' : 'en';
};

const translations: Record<Locale, Record<string, string>> = {
  zh: {
    app_loading: 'åŠ è½½ä¸­...',
    app_supabase_missing: 'æœªé…ç½® Supabase',
    app_profile_load_failed: 'ä¸ªäººèµ„æ–™åŠ è½½å¤±è´¥ï¼Œè¯·ç‚¹å‡»é‡è¯•',
    app_retry: 'é‡è¯•',
    app_close: 'å…³é—­',
    nav_home: 'é¦–é¡µ',
    nav_post: 'æŠ•ç¨¿',
    nav_rank: 'æ’è¡Œ',
    nav_profile: 'æˆ‘çš„',
    nav_messages: 'æ¶ˆæ¯',
    login_title: 'RoastHim éª‚ä»–',
    login_subtitle: 'ç™»å½•åå¼€å§‹åæ§½',
    login_email_login: 'é‚®ç®±ç™»å½•',
    login_email_signup: 'é‚®ç®±æ³¨å†Œ',
    login_email_placeholder: 'é‚®ç®±',
    login_password_placeholder: 'å¯†ç ',
    login_login: 'ç™»å½•',
    login_signup: 'æ³¨å†Œ',
    login_or: 'æˆ–',
    login_google_aria: 'Google ç™»å½•',
    login_wechat_aria: 'å¾®ä¿¡ç™»å½•',
    login_signup_success: 'æ³¨å†ŒæˆåŠŸï¼Œå·²è‡ªåŠ¨ç™»å½•ã€‚',
    login_signup_check_email: 'æ³¨å†ŒæˆåŠŸï¼Œè¯·æ£€æŸ¥é‚®ç®±è¿›è¡ŒéªŒè¯ã€‚',
    login_email_not_confirmed: 'é‚®ç®±æœªéªŒè¯',
    login_resend_email: 'é‡æ–°å‘é€éªŒè¯é‚®ä»¶',
    login_resend_sending: 'å‘é€ä¸­...',
    login_resend_done: 'éªŒè¯é‚®ä»¶å·²å‘é€ï¼Œè¯·æ£€æŸ¥é‚®ç®±ã€‚',
    login_wechat_only_mini: 'è¯·åœ¨å¾®ä¿¡å°ç¨‹åºå†…ä½¿ç”¨å¾®ä¿¡ç™»å½•ã€‚',
    login_wechat_failed: 'å¾®ä¿¡ç™»å½•å¤±è´¥',
    login_wechat_cancel: 'å¾®ä¿¡ç™»å½•å–æ¶ˆæˆ–å¤±è´¥',
    profile_logout: 'é€€å‡ºç™»å½•',
    profile_feedback: 'æäº¤åé¦ˆ',
    profile_feedback_title: 'æäº¤åé¦ˆ',
    profile_feedback_placeholder: 'å†™ä¸‹ä½ çš„æƒ³æ³•æˆ–å»ºè®®...',
    profile_feedback_empty: 'è¯·å¡«å†™åé¦ˆå†…å®¹',
    profile_feedback_thanks: 'æ„Ÿè°¢åé¦ˆï¼',
    profile_stats_targets: 'æŠ•ç¨¿å¯¹è±¡',
    profile_stats_roasts: 'å‘å¸ƒéª‚è¯„',
    profile_stats_likes: 'è·èµæ€»æ•°',
    profile_tab_roasts: 'æˆ‘çš„éª‚',
    profile_tab_targets: 'æˆ‘çš„æŠ•ç¨¿',
    profile_tab_badges: 'æˆ‘çš„å¾½ç« ',
    profile_roasts_empty: 'æš‚æ— éª‚è¯„è®°å½•',
    profile_targets_empty: 'è¿˜æ²¡æœ‰è¢«éª‚å¯¹è±¡å…¥åº“å“¦~',
    profile_targets_cta: 'å»æŠ•ç¨¿ä¸€ä¸ªï¼Ÿ',
    profile_roast_item: 'éª‚è¯„ Â· {name}',
    profile_roast_item_fallback: 'éª‚è¯„ Â· æŸ¥çœ‹åŸå¸–',
    profile_roast_likes: 'ğŸ‘ {count}',
    profile_roast_replies: 'ğŸ’¬ {count}',
    profile_target_roasts: '{count} æ¬¡è¢«éª‚',
    profile_need_login: 'è¯·å…ˆç™»å½•æŸ¥çœ‹ä¸ªäººèµ„æ–™',
    profile_loading: 'åŠ è½½ä¸­...',
    home_title: 'ä»Šå¤©ï¼Œæƒ³å–·è°ï¼Ÿ',
    home_subtitle: 'æœ€ç«çƒ­ã€æœ€æ–°çš„åæ§½éƒ½åœ¨è¿™é‡Œ',
    home_tab_hot: 'æœ€çƒ­',
    home_tab_new: 'æœ€æ–°',
    home_tab_champ: 'å† å†›',
    home_loading: 'åŠ è½½ä¸­...',
    home_empty: 'æš‚æ— æ•°æ®',
    home_top_roast_empty: 'è¿˜æ²¡äººéª‚TAï¼Œå¿«æ¥å½“ç¬¬ä¸€ä¸ªï¼',
    details_back: 'è¿”å›',
    details_tab_roasts: 'éª‚è¯„',
    details_tab_about: 'å…³äº TA',
    details_tab_photos: 'ç…§ç‰‡',
    details_tab_voice: 'è¯­éŸ³',
    details_comment_placeholder: 'è¯´ç‚¹å•¥...',
    details_comment_placeholder_strong: 'ç”¨æœ€çŠ€åˆ©çš„è¯éª‚ä»–...',
    details_reply_prefix: 'å›å¤ @{name}',
    details_reply: 'å›å¤',
    details_reply_cancel: 'å–æ¶ˆ',
    details_reply_more_count: 'æŸ¥çœ‹å…¶ä½™{count}æ¡å›å¤',
    details_send: 'å‘é€',
    details_send_login_only: 'ç™»å½•åæ‰èƒ½å‘è¡¨è¯„è®º',
    details_login_required_comment: 'éœ€è¦ç™»å½•åæ‰èƒ½å‘è¡¨è¯„è®ºå’Œç‚¹èµã€‚',
    details_login_cta: 'å»ç™»å½•',
    details_sort_hot: 'æœ€çƒ­',
    details_sort_new: 'æœ€æ–°',
    details_comments_title: 'è¯„è®ºåŒº ({count})',
    details_like: 'èµ',
    details_likes: '{count} èµ',
    details_roasts: '{count} æ¬¡è¢«éª‚',
    details_total_likes: '{count} æ¬¡è¢«èµ',
    details_profile_loading: 'åŠ è½½ä¸­...',
    details_profile_error: 'åŠ è½½å¤±è´¥',
    details_profile_close: 'å…³é—­',
    details_audio_record: 'æŒ‰ä½è¯´è¯',
    details_audio_stop: 'åœæ­¢å½•éŸ³',
    details_audio_send: 'å‘é€è¯­éŸ³',
    details_audio_play: 'æ’­æ”¾è¯­éŸ³',
    details_audio_transcript: 'è½¬æ–‡å­—',
    details_audio_transcript_hide: 'æ”¶èµ·æ–‡å­—',
    details_audio_transcript_placeholder: 'è¯­éŸ³è½¬æ–‡å­—ç»“æœï¼ˆå¯ç¼–è¾‘ï¼‰',
    details_audio_transcript_empty: 'æš‚æ— è½¬æ–‡å­—',
    details_audio_transcribing: 'è¯­éŸ³è¯†åˆ«ä¸­â€¦',
    details_audio_preview: 'è¯­éŸ³é¢„è§ˆ',
    details_audio_empty: 'å½•éŸ³ä¸ºç©ºï¼Œè¯·é‡è¯•',
    details_audio_unsupported: 'å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³å½•åˆ¶',
    details_audio_upload_failed: 'è¯­éŸ³ä¸Šä¼ å¤±è´¥',
    details_audio_comment_label: 'è¯­éŸ³è¯„è®º',
    details_text_profanity: 'å†…å®¹åŒ…å«ä¸å½“ç”¨è¯­ï¼Œè¯·ä¿®æ”¹åå†å‘é€',
    details_transcript_profanity: 'è½¬æ–‡å­—åŒ…å«ä¸å½“ç”¨è¯­ï¼Œè¯·ä¿®æ”¹åå†å‘é€',
    details_reply_more: 'å±•å¼€æ›´å¤šå›å¤',
    details_reply_hide: 'æ”¶èµ·å›å¤',
    post_title: 'æŠ•ç¨¿',
    post_step1_title: 'ç»å†æè¿°',
    post_step1_desc: 'è¶Šè¯¦ç»†è¶Šå¥½ï¼ŒAI æ›´å‡†',
    post_step1_placeholder: 'æè¿°ä½ å’Œ TA çš„ç»å†...',
    post_step1_record: 'è¯­éŸ³è¾“å…¥',
    post_step1_ai: 'ç”¨ AI ç”Ÿæˆ',
    post_step2_title: 'ç”Ÿæˆç»“æœ',
    post_step2_name: 'TA çš„æ˜µç§°',
    post_step2_type: 'å…³ç³»ç±»å‹',
    post_step2_desc: 'ä¸ºä»€ä¹ˆè¦éª‚ TA',
    post_step2_avatar: 'å¤´åƒé£æ ¼',
    post_step2_tags: 'æ ‡ç­¾ï¼ˆæœ€å¤š 3 ä¸ªï¼‰',
    post_step2_tags_placeholder: 'ç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼š#ç¤¾æ­», #è¿Ÿåˆ°',
    post_step2_back: 'è¿”å›ä¿®æ”¹ç»å†',
    post_step2_regen: 'é‡æ–°ç”Ÿæˆ',
    post_submit: 'æäº¤',
    post_loading: 'ç”Ÿæˆä¸­...',
    post_submit_loading: 'æäº¤ä¸­...',
    post_error_profanity: 'åŒ…å«ä¸æ–‡æ˜å†…å®¹ï¼Œè¯·ä¿®æ”¹åå†æäº¤',
    post_error_required: 'è¯·å…ˆå¡«å†™ç»å†æè¿°',
    post_voice_unsupported: 'å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¾“å…¥',
    post_need_experience: 'è¯·å…ˆè¾“å…¥ç»å†å†…å®¹',
    post_profanity_experience: 'ç»å†æè¿°åŒ…å«ä¸å½“ç”¨è¯­ï¼Œè¯·ä¿®æ”¹åå†ç”Ÿæˆ',
    post_missing_gemini: 'æœªé…ç½® GEMINI_API_KEY',
    post_parse_failed: 'è§£æå¤±è´¥',
    post_generate_failed: 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•',
    post_login_required: 'ç™»å½•åæ‰èƒ½æŠ•ç¨¿',
    post_login_cta: 'å»ç™»å½•',
    post_heading: 'æŠ•ç¨¿æ–°å¯¹è±¡ ğŸ”¥',
    post_experience_label: 'ç»å†æè¿°ï¼ˆå¯è¯­éŸ³è¾“å…¥ï¼‰',
    post_experience_placeholder: 'æè¿°ä¸€ä¸‹ä½ å’ŒTAçš„ç»å†ï¼Œè¶Šå…·ä½“è¶Šå¥½...',
    post_voice_stop: 'åœæ­¢å½•éŸ³',
    post_voice_input: 'è¯­éŸ³è¾“å…¥',
    post_generate_ai: 'ç”¨ AI ç”Ÿæˆ',
    post_next_hint: 'ç‚¹å‡»ç”Ÿæˆåè¿›å…¥ä¸‹ä¸€æ­¥',
    post_back_edit: 'è¿”å›ä¿®æ”¹ç»å†',
    post_regen: 'é‡æ–°ç”Ÿæˆ',
    post_name_label: 'TAçš„æ˜µç§° (å¿…å¡«)',
    post_name_placeholder: 'ä¾‹å¦‚ï¼šå¥‡è‘©é¢†å¯¼è€ç‹',
    post_type_label: 'å…³ç³»/ç±»å‹',
    post_desc_label: 'ä¸ºä»€ä¹ˆè¦éª‚TAï¼Ÿ (å¿…å¡«)',
    post_desc_placeholder: 'æè¿°ä¸€ä¸‹TAåšè¿‡çš„é‚£äº›å¥‡è‘©äº‹...',
    post_tags_label: 'æ ‡ç­¾ï¼ˆæœ€å¤š3ä¸ªï¼Œç”¨é€—å·åˆ†éš”ï¼‰',
    post_tags_placeholder: '#èŒåœº,#æ”¹ç¨¿ç‹,#ç”²æ–¹',
    post_style_label: 'å¤´åƒé£æ ¼',
    post_submit_now: 'ç«‹å³æäº¤ ğŸš€',
    leaderboard_title: 'æ’è¡Œæ¦œ',
    leaderboard_daily: 'ä»Šæ—¥å† å†›',
    leaderboard_top: 'æœ¬å‘¨é£äº‘',
    leaderboard_hof: 'åäººå ‚',
    leaderboard_loading: 'åŠ è½½ä¸­...',
    leaderboard_heading: 'è£èª‰æ¦œ ğŸ†',
    leaderboard_streak: 'è‰è”å† å†› x{count}',
    leaderboard_top_today: 'ä»Šæ—¥ TOP 10',
    messages_title: 'æ¶ˆæ¯',
    messages_loading: 'åŠ è½½ä¸­...',
    messages_empty: 'æš‚æ— æ¶ˆæ¯',
    messages_new_comment: 'ä½ çš„æŠ•ç¨¿æ”¶åˆ°ä¸€æ¡æ–°è¯„è®º',
    messages_new_like: 'ä½ çš„è¯„è®ºæ”¶åˆ°ä¸€ä¸ªæ–°çš„èµ',
    messages_just_now: 'åˆšåˆš',
    messages_unread: 'æœªè¯»',
    onboarding_title: 'å®Œå–„èµ„æ–™',
    onboarding_subtitle: 'ç¬¬ä¸€æ¬¡ç™»å½•è¯·å¡«å†™',
    onboarding_name: 'ç”¨æˆ·æ˜µç§°',
    onboarding_name_placeholder: 'æ¯’èˆŒå°ç‹å­',
    onboarding_quote: 'ç”¨æˆ·æè¿°',
    onboarding_quote_placeholder: 'é”®ç›˜åœ¨æ‰‹ï¼Œå¤©ä¸‹æˆ‘æœ‰ã€‚åæ§½ä¸æ¯ï¼Œæˆ˜æ–—ä¸æ­¢ã€‚',
    onboarding_submit: 'å®Œæˆ',
    onboarding_save_failed: 'ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•',
    require_login: 'éœ€è¦ç™»å½•åæ‰èƒ½æ“ä½œ'
  },
  en: {
    app_loading: 'Loading...',
    app_supabase_missing: 'Supabase not configured',
    app_profile_load_failed: 'Failed to load profile. Tap to retry.',
    app_retry: 'Retry',
    app_close: 'Close',
    nav_home: 'Home',
    nav_post: 'Post',
    nav_rank: 'Rank',
    nav_profile: 'Me',
    nav_messages: 'Inbox',
    login_title: 'RoastHim',
    login_subtitle: 'Sign in to start roasting',
    login_email_login: 'Email Login',
    login_email_signup: 'Email Sign Up',
    login_email_placeholder: 'Email',
    login_password_placeholder: 'Password',
    login_login: 'Sign in',
    login_signup: 'Sign up',
    login_or: 'or',
    login_google_aria: 'Sign in with Google',
    login_wechat_aria: 'Sign in with WeChat',
    login_signup_success: 'Sign-up successful. You are logged in.',
    login_signup_check_email: 'Sign-up successful. Please check your email.',
    login_email_not_confirmed: 'Email not confirmed',
    login_resend_email: 'Resend verification email',
    login_resend_sending: 'Sending...',
    login_resend_done: 'Verification email sent.',
    login_wechat_only_mini: 'Please use WeChat login in Mini Program.',
    login_wechat_failed: 'WeChat login failed',
    login_wechat_cancel: 'WeChat login cancelled or failed',
    profile_logout: 'Sign out',
    profile_feedback: 'Feedback',
    profile_feedback_title: 'Submit feedback',
    profile_feedback_placeholder: 'Share your thoughts or suggestions...',
    profile_feedback_empty: 'Please enter feedback',
    profile_feedback_thanks: 'Thanks for the feedback!',
    profile_stats_targets: 'Targets',
    profile_stats_roasts: 'Roasts',
    profile_stats_likes: 'Likes received',
    profile_tab_roasts: 'My roasts',
    profile_tab_targets: 'My targets',
    profile_tab_badges: 'My badges',
    profile_roasts_empty: 'No roasts yet',
    profile_targets_empty: 'No targets yet',
    profile_targets_cta: 'Create one?',
    profile_roast_item: 'Roast Â· {name}',
    profile_roast_item_fallback: 'Roast Â· View post',
    profile_roast_likes: 'ğŸ‘ {count}',
    profile_roast_replies: 'ğŸ’¬ {count}',
    profile_target_roasts: '{count} roasts',
    profile_need_login: 'Please sign in to view profile',
    profile_loading: 'Loading...',
    home_title: 'Who do you want to roast?',
    home_subtitle: 'Hot and new roasts all here',
    home_tab_hot: 'Hot',
    home_tab_new: 'New',
    home_tab_champ: 'Champ',
    home_loading: 'Loading...',
    home_empty: 'No data',
    home_top_roast_empty: 'Be the first to roast!',
    details_back: 'Back',
    details_tab_roasts: 'Roasts',
    details_tab_about: 'About',
    details_tab_photos: 'Photos',
    details_tab_voice: 'Voice',
    details_comment_placeholder: 'Say something...',
    details_comment_placeholder_strong: 'Say your sharpest roast...',
    details_reply_prefix: 'Reply @{name}',
    details_reply: 'Reply',
    details_reply_cancel: 'Cancel',
    details_reply_more_count: 'Show {count} more replies',
    details_send: 'Send',
    details_send_login_only: 'Sign in to comment',
    details_login_required_comment: 'Sign in to comment and like.',
    details_login_cta: 'Sign in',
    details_sort_hot: 'Top',
    details_sort_new: 'Newest',
    details_comments_title: 'Comments ({count})',
    details_like: 'Like',
    details_likes: '{count} likes',
    details_roasts: '{count} roasts',
    details_total_likes: '{count} likes total',
    details_profile_loading: 'Loading...',
    details_profile_error: 'Load failed',
    details_profile_close: 'Close',
    details_audio_record: 'Hold to record',
    details_audio_stop: 'Stop recording',
    details_audio_send: 'Send voice',
    details_audio_play: 'Play voice',
    details_audio_transcript: 'Transcript',
    details_audio_transcript_hide: 'Hide transcript',
    details_audio_transcript_placeholder: 'Transcript (editable)',
    details_audio_transcript_empty: 'No transcript available',
    details_audio_transcribing: 'Transcribing...',
    details_audio_preview: 'Voice preview',
    details_audio_empty: 'Empty recording. Try again.',
    details_audio_unsupported: 'Audio recording not supported',
    details_audio_upload_failed: 'Audio upload failed',
    details_audio_comment_label: 'Voice comment',
    details_text_profanity: 'Inappropriate content. Please edit and resend.',
    details_transcript_profanity: 'Transcript contains inappropriate content.',
    details_reply_more: 'Show more replies',
    details_reply_hide: 'Hide replies',
    post_title: 'Post',
    post_step1_title: 'Experience',
    post_step1_desc: 'More detail helps AI',
    post_step1_placeholder: 'Describe your experience...',
    post_step1_record: 'Voice input',
    post_step1_ai: 'Generate with AI',
    post_step2_title: 'Generated result',
    post_step2_name: 'Nickname',
    post_step2_type: 'Relationship',
    post_step2_desc: 'Why roast them',
    post_step2_avatar: 'Avatar style',
    post_step2_tags: 'Tags (up to 3)',
    post_step2_tags_placeholder: 'Comma separated, e.g. #awkward, #late',
    post_step2_back: 'Back to edit',
    post_step2_regen: 'Regenerate',
    post_submit: 'Submit',
    post_loading: 'Generating...',
    post_submit_loading: 'Submitting...',
    post_error_profanity: 'Inappropriate content. Please revise.',
    post_error_required: 'Please enter experience first',
    post_voice_unsupported: 'Voice input not supported in this browser',
    post_need_experience: 'Please enter your experience first',
    post_profanity_experience: 'Inappropriate content in experience. Please revise.',
    post_missing_gemini: 'GEMINI_API_KEY not configured',
    post_parse_failed: 'Parse failed',
    post_generate_failed: 'Generation failed. Please try again.',
    post_login_required: 'Sign in to post',
    post_login_cta: 'Sign in',
    post_heading: 'Post a new target ğŸ”¥',
    post_experience_label: 'Experience (voice input supported)',
    post_experience_placeholder: 'Describe your experience with them...',
    post_voice_stop: 'Stop recording',
    post_voice_input: 'Voice input',
    post_generate_ai: 'Generate with AI',
    post_next_hint: 'Generating will move to the next step',
    post_back_edit: 'Back to edit',
    post_regen: 'Regenerate',
    post_name_label: 'Nickname (required)',
    post_name_placeholder: 'e.g. The Worst Boss',
    post_type_label: 'Relationship',
    post_desc_label: 'Why roast them? (required)',
    post_desc_placeholder: 'Describe what they did...',
    post_tags_label: 'Tags (up to 3, comma separated)',
    post_tags_placeholder: '#work,#revision,#client',
    post_style_label: 'Avatar style',
    post_submit_now: 'Submit ğŸš€',
    leaderboard_title: 'Leaderboard',
    leaderboard_daily: 'Daily champ',
    leaderboard_top: 'Weekly top',
    leaderboard_hof: 'Hall of fame',
    leaderboard_loading: 'Loading...',
    leaderboard_heading: 'Honors ğŸ†',
    leaderboard_streak: 'Streak x{count}',
    leaderboard_top_today: 'Today TOP 10',
    messages_title: 'Messages',
    messages_loading: 'Loading...',
    messages_empty: 'No messages',
    messages_new_comment: 'New comment on your post',
    messages_new_like: 'New like on your comment',
    messages_just_now: 'Just now',
    messages_unread: 'Unread',
    onboarding_title: 'Complete profile',
    onboarding_subtitle: 'Please fill in for first login',
    onboarding_name: 'Nickname',
    onboarding_name_placeholder: 'RoastMaster',
    onboarding_quote: 'Bio',
    onboarding_quote_placeholder: 'Keyboard ready, roast steady.',
    onboarding_submit: 'Finish',
    onboarding_save_failed: 'Save failed. Please try again.',
    require_login: 'Please sign in to continue'
  }
};

export const t = (key: string, vars?: Record<string, string | number>) => {
  const locale = detectLocale();
  const template = translations[locale][key] ?? translations.en[key] ?? key;
  if (!vars) return template;
  return template.replace(/\{(\w+)\}/g, (_, k) => String(vars[k] ?? ''));
};

export const getLocale = () => detectLocale();
